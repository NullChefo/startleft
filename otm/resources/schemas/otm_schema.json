{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://iriusrisk.com/schema/otm-0.1.0.schema.json",
    "title": "Open Threat Model Specification",
    "$comment" : "Open Threat Model JSON schema is published under the terms of the Apache License 2.0.",
    "type": "object",
    "required": ["project", "otmVersion"],
    "properties": {
        "project": {
            "type": ["object", "null"],
            "required": ["name", "id"],
            "properties": {
                "name": {"type": "string"},
                "id": {"type": "string"},
                "description": {"type": ["string", "null"]},
                "owner": {"type": ["string", "null"]},
                "ownerContact": {"type": ["string", "null"]},
                "tags": {
                    "type": ["array", "null"],
                    "items": {
                        "type": ["string", "null"]
                    }
                },
                "attributes": {"type": ["object", "null"]}
            }
        },
        "representations": {
            "type": ["array", "null"],
            "required": ["name", "id", "type"],
            "properties": {
                "name": {"type": "string"},
                "id": {"type": "string"},
                "type": {"type": "string"},
                "description": {"type": ["string", "null"]},
                "size": {"$ref": "#/definitions/size"},
                "repository": {
                    "type": ["object", "null"],
                    "required": ["url"],
                    "properties": {
                        "url": {"type": ["string", "null"]}
                    }
                },
                "attributes": {"type": ["object", "null"]}
            }
        },
        "assets": {
            "type": "array",
            "required": ["name", "id", "risk"],
            "properties": {
                "name": {"type": "string"},
                "id": {"type": "string"},
                "description": {"type": ["string", "null"]},
                "risk": {
                    "type": ["object", "null"],
                    "required": ["confidentiality", "integrity", "availability"],
                    "properties": {
                        "confidentiality": {"type": "number"},
                        "integrity": {"type": "number"},
                        "availability": {"type": "number"},
                        "comment": {"type": ["string", "null"]}
                    }
                },
                "attributes": {"type": ["object", "null"]}
            }
        },
        "trustZones": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name", "risk"],
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "type": {"type": "string"},
                    "description": {"type": ["string", "null"]},
                    "risk": {
                        "type": "object",
                        "required": ["trustRating"],
                        "properties": {
                            "trustRating": {"type": "number"}
                        }
                    },
                    "parent": {"$ref": "#/definitions/parent"},
                    "representations": {
                        "type": "array",
                        "items": {"$ref": "#/definitions/representationElement"}
                    },
                    "attributes": {"type": ["object", "null"]}
                }
            }
        },
        "components": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name", "type", "parent"],
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "type": {"type": "string"},
                    "description": {"type": ["string", "null"]},
                    "parent": {"$ref": "#/definitions/parent"},
                    "representations": {
                        "type": ["array", "null"],
                        "items": {"$ref": "#/definitions/representationElement"}
                    },
                    "assets": {
                        "type": ["object", "null"],
                        "properties": {
                            "stored": {
                                "type": ["array", "null"],
                                "items": {
                                    "type": ["string", "null"]
                                }
                            },
                            "processed": {
                                "type": ["array", "null"],
                                "items": {
                                    "type": ["string", "null"]
                                }
                            }
                        }
                    },
                    "threats": {
                        "type": ["array", "null"],
                        "items": {"$ref": "#/definitions/threat/"}
                    },
                    "tags": {
                        "type": ["array", "null"],
                        "items": {
                            "type": ["string", "null"]
                        }
                    },
                    "attributes": {"type": ["object", "null"]}
                }
            }
        },
        "dataflows": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name", "source", "destination"],
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "description": {"type": ["string", "null"]},
                    "bidirectional": {"type": "boolean"},
                    "source": {"type": "string"},
                    "destination": {"type": "string"},
                    "assets": {
                        "type": ["array", "null"],
                        "items": {"type": ["string", "null"]}
                    },
                    "threats": {
                        "type": ["array", "null"],
                        "items": {"$ref": "#/definitions/threat/"}
                    },
                    "tags": {
                        "type": ["array", "null"],
                        "items": {
                            "type": ["string", "null"]
                        }
                    },
                    "attributes": {"type": ["object", "null"]}
                }
            }
        },
        "threats": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name", "risk"],
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "description": {"type": ["string", "null"]},
                    "categories": {
                        "type": ["array", "null"],
                        "items": {"type": ["string", "null"]}
                    },
                    "cwes": {
                        "type": ["array", "null"],
                        "items": {"type": ["string", "null"]}
                    },
                    "risk": {
                        "type": "object",
                        "required": ["likelihood", "impact"],
                        "properties": {
                            "likelihood": {"type": "number"},
                            "likelihoodComment": {"type": "string"},
                            "impact": {"type": "number"},
                            "impactComment": {"type": "string"}
                        }
                    },
                    "tags": {
                        "type": ["array", "null"],
                        "items": {
                            "type": ["string", "null"]
                        }
                    },
                    "attributes": {"type": ["object", "null"]}
                }
            }
        },
        "mitigations": {
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name", "riskReduction"],
                "properties": {
                    "id": {"type": "string"},
                    "name": {"type": "string"},
                    "description": {"type": ["string", "null"]},
                    "riskReduction": {"type": "number"},
                    "attributes": {"type": ["object", "null"]}
                }
            }
        }
    },
    "definitions": {
        "size": {
            "type": "object",
            "required": ["width", "height"],
            "properties": {
                "width": {"type": "number"},
                "height": {"type": "number"}
            }
        },
        "parent": {
            "type": "object",
            "oneOf": [
                {"required": ["trustZone"]},
                {"required":["component"]}
            ],
            "properties": {
                "trustZone": {"type": "string"},
                "component": {"type": "string"}
            }
        },
        "position": {
            "type": "object",
            "required": ["x", "y"],
            "properties": {
                "x": {"type": "number"},
                "y": {"type": "number"}
            }
        },
        "representationElement": {
            "type": "object",
            "required": ["representation", "id"],
            "properties": {
                "representation": {"type": "string"},
                "name": {"type": ["string", "null"]},
                "id": {"type": "string"},
                "position": {"$ref": "#/definitions/position"},
                "size": {"$ref": "#/definitions/size"},
                "file": {"type": ["string", "null"]},
                "line": {"type": ["number", "null"]},
                "codeSnippet": {"type": ["string", "null"]},
                "attributes": {"type": ["object", "null"]}
            }
        },
        "threat": {
            "type": "object",
            "required": ["threat", "state"],
            "properties": {
                "threat": {"type": "string"},
                "state": {"type": "string"},
                "mitigations": {
                    "type": "array",
                    "items": {
                        "type": ["object", "null"],
                        "required": ["mitigation", "state"],
                        "properties": {
                            "mitigation": {"type": ["string", "null"]},
                            "state": {"type": ["string", "null"]}
                        }
                    }
                }
            }
        }
    }
}
